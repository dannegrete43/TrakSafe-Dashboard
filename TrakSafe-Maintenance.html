<script type="module">
    // Import the security guard and database connection from our auth.js file
    import { db, protectPage } from './js/auth.js'; 
    
    // Import any specific Firebase functions you need for this page
    import { collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    
    // Run the security check FIRST!
    protectPage();

    // --- All of your specific logic for the MAINTENANCE page goes below ---

    // Get references to your HTML elements for this page
    const maintenanceList = document.getElementById('maintenance-list');
    const loadingSpinner = document.getElementById('loading-spinner');

    function renderMaintenanceJobs(jobs) {
        // Clear the current list
        maintenanceList.innerHTML = '';
        
        // This is an example function. You'll need to create the HTML structure
        // that matches your maintenance data.
        jobs.forEach(job => {
            const date = job.date ? job.date.toDate().toLocaleString() : 'N/A';
            maintenanceList.innerHTML += `
                <div class="bg-white p-4 rounded-lg shadow">
                    <p class="font-semibold">${job.extinguisherId || 'N/A'}</p>
                    <p class="text-sm text-gray-600">Issue: ${job.issue || 'Not specified'}</p>
                    <p class="text-xs text-gray-500">Reported on: ${date}</p>
                </div>
            `;
        });
    }

    function initialize() {
        // Set up the listener for the "maintenance" collection.
        // Make sure you have a collection with this name in Firestore.
        const q = query(collection(db, "maintenance"), orderBy("date", "desc"));
        
        onSnapshot(q, (snapshot) => {
            if(loadingSpinner) loadingSpinner.classList.add('hidden');
            const jobs = snapshot.docs.map(doc => doc.data());
            renderMaintenanceJobs(jobs);
        }, (error) => {
            console.error("Error fetching maintenance data:", error);
            if(loadingSpinner) loadingSpinner.classList.add('hidden');
            if(maintenanceList) maintenanceList.innerHTML = '<p class="text-red-500">Error fetching data.</p>';
        });
    }

    // Run your page-specific logic when the window loads
    window.onload = initialize;
</script>
